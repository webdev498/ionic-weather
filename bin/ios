#!/bin/bash
set -e

DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )

echo "Killing XCode..."
xcodepids=$(ps aux | grep 'Xcod[e]' | awk '{print $2}')
if [ "$xcodepids" ]; then
  kill $xcodepids;
fi
echo "It's dead"

echo "Removing old XCode project"
ember cordova platform remove ios

echo "Adding ios platform"
ember cordova platform add ios

echo "Adding plugins"
source  $DIR/install_plugins

echo "Building XCode project"
MOBILE_PLATFORM=ios ember cordova:build --environment ${EMBER_ENV:=staging} --platform ios

echo "Opening XCode project"
ember cordova:open
