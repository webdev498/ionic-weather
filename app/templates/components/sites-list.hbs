<header class="bar bar-nav weathermatic-header">
  <a href="javascript:void(0)" class="icon pull-left {{searchIcon}}" {{action 'toggleSearch'}}></a>
  {{logo-header}}
  <a href="javascript:void(0)" class="icon icon-gear pull-right" {{action 'openOptionsMenu'}}></a>
</header>

{{#pull-to-refresh refreshData='refreshData'}}
  <div class="content weathermatic-content">
    <ul class="table-view">
      <li class="content-padded weathermatic-sites-search hidden">
        {{input type='search' placeholder='Search Sites' value=search}}
        <button disabled={{isSearchEmpty}} {{action 'performSearch'}}
          class="btn btn-inverse btn-primary btn-block">{{fa-icon 'search'}} {{t 'common.search'}}</button>
      </li>
      <li class="table-view-cell table-view-divider">
        {{fa-icon 'building'}} {{t 'sites.yourSites'}}
        <button class="btn btn-outlined" {{action 'openSortOptions'}}>
          {{#if isSortByProximity}}
            {{fa-icon 'globe'}} sorted by location
          {{/if}}
          {{#if isSortByAlpha}}
            {{fa-icon 'sort-alpha-asc'}} sorted by name
          {{/if}}
        </button>
      </li>
      {{#each model.sites as |site|}}
        <li class="table-view-cell media">
          <a href="javascript:void(0)" class="navigate-right" {{action 'goToSite' site}}>
            <div class="media-body">
              <strong>{{site.name}}</strong>
              <p>
                <small class="badge">{{site.cityState}}</small>
                <small class="badge controller-count-badge">{{site.controllersCount}} controllers</small>
                {{#if site.milesAway}}
                  <small class="badge location-badge">{{fa-icon 'location-arrow'}} {{format-number site.milesAway round=true}} mi</small>
                {{/if}}
                {{#if site.faultsCount}}
                  <small class="badge badge-negative">{{site.faultsCount}} faults</small>
                {{/if}}
              </p>
            </div>
          </a>
        </li>
      {{else}}
        {{#unless isLoading}}
          <li class="table-view-cell media">
            <center>
              <h1>{{fa-icon 'times'}} Not found</h1>
              {{#if lastSearch.length}}
                <p>We didn't find any sites that match:</p>
                <h2 class="weathermatic-search-not-found-term">{{lastSearch}}</h2>
              {{/if}}
            </center>
          </li>
        {{/unless}}
      {{/each}}
    </ul>
    {{#if shouldShowLoading}}
      <div class="content-padded loading-icon">
        <center>{{fa-icon 'refresh fa-spin'}} Loadingâ€¦</center>
      </div>
    {{/if}}
    <div class="weathermatic-page-bottom"></div>
  </div>

  <div id="options-menu" class="modal {{if isOptionsMenuOpen 'active'}}">
    <header class="bar bar-nav weathermatic-header">
      <a class="icon icon-close pull-right" href="javascript:void(0)" {{action 'closeOptionsMenu'}}></a>
      <h1 class="title">{{fa-icon 'gear' classNames='spaced-icon'}} Options</h1>
    </header>

    <div class="content weathermatic-content">
      <ul class="table-view">
        <li class="table-view-cell">
          <a href="javscript:void(0)" {{action 'logOut'}}>
            <div class="media-body">
              <h2>{{fa-icon 'sign-out' classNames='spaced-icon'}} Log out</h2>
              <p>Enter your email and password to log back in</p>
            </div>
          </a>
        </li>
        <li class="table-view-cell">
          <a href="javascript:void(0)" {{action 'syncSites'}}>
            <div class="media-body">
              <h2>{{fa-icon 'refresh' classNames='spaced-icon'}} Sync Sites</h2>
              <p>Refresh the latest data from our servers</p>
            </div>
          </a>
        </li>
        {{#unless geolocationUnavailable}}
        <li class="table-view-cell">
          <a href="javascript:void(0)" {{action 'openSortOptions'}}>
            <div class="media-body">
              <h2>{{fa-icon 'sort' classNames='spaced-icon'}} Sort Sites</h2>
              <p>Change the sort order for the sites list</p>
            </div>
          </a>
        </li>
        {{/unless}}
        <li class="table-view-cell">
          <a href="javascript:void(0)" {{action 'sendFeedback'}}>
            <div class="media-body">
              <h2>{{fa-icon 'comment-o' classNames='spaced-icon'}} Send Feedback</h2>
              <p>Send us feedback about this app</p>
            </div>
          </a>
        </li>
        <li class="table-view-cell">
          <a href="javascript:void(0)" {{action 'launchFullSite'}}>
            <div class="media-body">
              <h2>{{fa-icon 'external-link' classNames='spaced-icon'}} Launch Full Site</h2>
              <p>Open the Smartlink website in a web browser</p>
            </div>
          </a>
        </li>
      </ul>

      <div class="content-padded">
        <button class="btn btn-negative btn-block" {{action 'closeOptionsMenu'}}>
          {{fa-icon 'times-circle'}} Close
        </button>
      </div>

      {{#if appVersion}}
        <p class="app-version">Version {{appVersion}}</p>
      {{/if}}
    </div>
  </div>

  <div id="sites-sort-options" class="modal {{if isSortOptionsOpen 'active'}}">
    <header class="bar bar-nav weathermatic-header">
      <a class="icon icon-close pull-right" href="javascript:void(0)" {{action 'closeSortOptions'}}></a>
      <h1 class="title">{{fa-icon 'sort' classNames='spaced-icon'}} Sort Options</h1>
    </header>

    <div class="content weathermatic-content">
      <ul class="table-view">
        <li class="table-view-cell">
          <a href="javascript:void(0)" {{action 'setSortMethod' 'proximity'}}>
            <div class="media-body">
              <h2>{{fa-icon 'globe' classNames='spaced-icon'}} Sort by Location</h2>
              <p>Nearest sites will appear first</p>
            </div>
          </a>
        </li>
        <li class="table-view-cell">
          <a href="javascript:void(0)" {{action 'setSortMethod' 'alpha'}}>
            <div class="media-body">
              <h2>{{fa-icon 'sort-alpha-asc' classNames='spaced-icon'}} Sort by Name</h2>
              <p>Sites will appear A-Z by name</p>
            </div>
          </a>
        </li>
      </ul>

      <div class="content-padded">
        <button class="btn btn-negative btn-block" {{action 'closeSortOptions'}}>
          {{fa-icon 'times-circle'}} Cancel
        </button>
      </div>
    </div>
  </div>
{{/pull-to-refresh}}
