<header class="bar bar-nav weathermatic-header">
  {{#link-to 'site' class='btn btn-link btn-nav pull-left'}}
    <span class="icon icon-left-nav"></span>
  {{/link-to}}
  <a href="javascript:void(0)" class="icon icon-gear pull-right" {{action 'openOptionsMenu'}}></a>
  <h1 class="title">{{fa-icon 'signal'}} {{short-text model.site.name size=10}} - {{short-text model.name size=10}}</h1>
</header>


<div id="smartlink-controller-container" class="content weathermatic-content">
  <div class="content-padded">
    {{#if model.canRunCommands}}
      <div class="card">
        <ul class="table-view">
          <li class="table-view-cell table-view-divider">
            {{fa-icon 'wrench'}} Actions
          </li>
          <li class="table-view-cell">
            {{#link-to 'smartlink-controller.select-program' class='push-right'}}
              {{fa-icon 'play'}} Run Program
            {{/link-to}}
          </li>
          <li class="table-view-cell">
            {{#link-to 'smartlink-controller.select-zone' class='push-right'}}
              {{fa-icon 'leaf'}} Run Zone
              {{/link-to}}
          </li>
          <li class="table-view-cell">
            {{#link-to 'smartlink-controller.select-valves' class='push-right'}}
              {{fa-icon 'crosshairs'}} Locate Valve
            {{/link-to}}
          </li>
          <li class="table-view-cell">
            {{#link-to 'smartlink-controller.walk-site' class='push-right'}}
              {{fa-icon 'male'}} Walk Site
            {{/link-to}}
          </li>
        </ul>
      </div>

      {{#link-to 'smartlink-controller.stop-all' class='btn btn-block btn-negative'}}
        {{fa-icon 'stop'}} Stop All
      {{/link-to}}
    {{else}}
      <span class="btn btn-block btn-negative btn-outlined">
        <h3>{{fa-icon 'warning'}} Limited Access</h3>
        <p>It looks like you are not allowed to run <br>remote commands on this controller</p>
      </span>
    {{/if}}
  </div>

  {{#if isLoading}}
    <div class="content-padded weathermatic-smartlink-controller-loading">
      <center>
        <!-- why this looks so weird??? -->
        <i class="fa fa-refresh fa-spin fa-lg"></i>
      </center>
      <br>
    </div>
  {{/if}}

  <ul class="table-view">
    <li class="table-view-cell table-view-divider">
      {{fa-icon 'gears'}} Controller Details
    </li>
    <li class="table-view-cell">
      System Status
      <button {{bind-attr class=':btn runStatusCssClass'}}>{{model.runStatusForHumans}}</button>
    </li>
    <li class="table-view-cell">
      Watering Mode
      {{#if model.isSmartWateringMode}}
        <button class="btn btn-positive">Smart</button>
      {{else}}
        <button class="btn btn-primary">Manual</button>
      {{/if}}
    </li>
    <li class="table-view-cell">
      Rain/Freeze
      {{#if model.isRainFreezeSensorEnabled}}
        <button class="btn btn-positive">Active</button>
      {{else}}
        <button class="btn btn-negative">Bypass</button>
      {{/if}}
    </li>
    <li class="table-view-cell">
      Weather
      {{#if model.weather.length}}
        <button {{bind-attr class='model.isWeatherBad:btn-negative:btn-positive :btn'}}>
          {{model.weather}}
        </button>
      {{else}}
        <button class="btn btn-primary">
          No Data
        </button>
      {{/if}}
    </li>

    {{#if model.faults.length}}
      <li class="table-view-cell table-view-divider">
        {{fa-icon 'warning'}} Faults <span class="badge badge-negative">{{model.faults.length}}</span>
      </li>
    {{/if}}
  </ul>

  {{#if model.faults.length}}
    <div class="content-padded weathermatic-controller-details-faults">
      {{#each fault in model.faults}}
        <button class="btn btn-negative">{{fault.description}}</button>
      {{/each}}

      {{#if model.canRunCommands}}
        {{#link-to 'smartlink-controller.clear-faults' class='btn btn-block btn-primary'}}
          {{fa-icon 'fa-refresh'}} Clear Faults
        {{/link-to}}
      {{/if}}
    </div>
  {{/if}}
</div>

<div id="options-menu" {{bind-attr class=':modal isOptionsMenuOpen:active'}}>
  <header class="bar bar-nav weathermatic-header">
    <a class="icon icon-close pull-right" href="javascript:void(0)" {{action 'closeOptionsMenu'}}></a>
    <h1 class="title">{{fa-icon 'gear'}} Advanced Options</h1>
  </header>

  <div class="content weathermatic-content">
    <ul class="table-view">
      <li class="table-view-cell">
        <a href="javascript:void(0)" {{action 'openCommLog'}}>
          <div class="media-body">
            <h2>{{fa-icon 'list'}} Comm Log</h2>
            <p>View currently running and recent commands</p>
          </div>
        </a>
      </li>
      <li class="table-view-cell">
        <a href="javascript:void(0)" {{action 'refreshData'}}>
          <div class="media-body">
            <h2>{{fa-icon 'refresh'}} Re-sync</h2>
            <p>Refresh with the latest data from our servers</p>
          </div>
        </a>
      </li>
    </ul>

    <div class="content-padded">
      <button class="btn btn-negative btn-block" {{action 'closeOptionsMenu'}}>
        {{fa-icon 'times-circle'}} Close
      </button>
    </div>
  </div>
</div>

{{!
  `actionReceiver` attribute exposes component action to the outside world.
  Uses this add-on: https://github.com/GavinJoyce/ember-component-inbound-actions
}}
{{comm-log smartlinkController=model close='commLogClosed' actionReceiver=commLog}}
